---
description: Контекст проекта — суть, стек, общие правила
globs: 
alwaysApply: true
---

# Контекст проекта: Telegram Parser & Publisher

## Суть проекта

Автоматическая система, которая:
1. **Мониторит** канал-источник Telegram (через userbot @riskerlb)
2. **Обрабатывает** новые посты с PDF: извлекает текст, генерирует саммари через OpenAI
3. **Отправляет** саммари редактору в боте @Neuralookerbot с кнопками: Опубликовать / Редактировать / Отклонить
4. **Публикует** утверждённые посты в целевой Telegram-канал (текст + PDF)

Домен n8n: **n8n.neurascope.pro**. Сервер: VPS 90.156.134.38.

## Стек

- **Python 3.11** — userbot и editor-bot
- **Telethon + opentele** — мониторинг канала (userbot)
- **aiogram 3.x** — бот для редактора
- **n8n** — извлечение текста из PDF, OpenAI, оркестрация
- **PostgreSQL 15** — посты, конфиг, audit_log
- **Docker Compose** — оркестрация
- **Nginx + Let's Encrypt** — reverse proxy и SSL
- **structlog** — логирование
- **pytest + pytest-asyncio** — тесты

## Общие правила

- **Модульность**: код разбит на handlers, services, database, utils. Легко редактировать и масштабировать.
- **Версии**: используем git; каждый значимый этап — коммит, чтобы можно было откатиться.
- **Документация**: все модули и публичные функции имеют docstrings (Google style).
- **Безопасность**: секреты только в `.env`; никогда не коммитить `.env`. Проверять входные данные, не допускать инъекций.
- **Логирование**: все ошибки логировать на сервере (structlog), критичные действия — в audit_log в БД.
- **Оптимизация**: минимизировать запросы к БД и API, использовать пулы соединений.
- **UI**: продуманный, понятный интерфейс для редактора (кнопки, подсказки, подтверждения).
- **Тесты**: автоматические тесты критичных потоков (approve/edit/reject, webhook, публикация).
- **Команды**: все команды, которые можно выполнить автоматически (git, docker, pytest), выполняются в процессе разработки.
